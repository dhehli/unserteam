function basicAuth(e,a){const t=e+":"+a;return"Basic "+btoa(t)}function ajaxHandler(e,a,t,r){return $.ajax({method:e,url:baseURI+a,data:JSON.stringify(t),beforeSend(e){if($.mobile.loading("show"),"yes"===r){const{email:a,password:r}=t;e.setRequestHeader("Authorization",basicAuth(a,r))}else"session"===r&&e.setRequestHeader("Authorization",$.session.get("Authorization"))},complete(){$.mobile.loading("hide")}})}function alertHandler(e,a,t){return e.show(),"success"===a?e.addClass("alert-success").html(t):"danger"===a?e.addClass("alert-danger").html(t):void 0}const baseURI="https://zbw.lump.ch";$(document).on("pagecontainershow",()=>{$(".alert").hide(),"user"!==$("body").pagecontainer("getActivePage").prop("id")||$.session.get("Authorization")||$.mobile.pageContainer.pagecontainer("change","#welcome"),$(".logout").click(e=>{$.session.remove("Authorization"),$.mobile.pageContainer.pagecontainer("change","#welcome")})});const panel='<div data-role="panel" data-display="push" data-theme="b" id="navigation"><ul data-role="listview"><li data-icon="delete"><a href="#" data-rel="close">Close menu</a></li><li><a href="#user">User</a></li><li><a href="#team">Team</a></li><li><a href="#training">Trainings</a></li><li><a href="#" class="logout">Logout</a></li></ul></div>';$(document).one("pagebeforecreate",function(){$.mobile.pageContainer.prepend(panel),$("#navigation").panel().enhanceWithin()}),$(document).on("pagebeforeshow",()=>{const e=$("body").pagecontainer("getActivePage").prop("id");if($alert=$(".alert-member"),"team-detail"===e){const e=window.currentId;function a(){const t=[];ajaxHandler("get",`/api/v1/teams/${e}`,{},"session").then(e=>{const a=JSON.parse(e);if(a.type)alertHandler($alert,"danger",a.message);else{const{Members:e}=a[0];e.forEach(e=>{const{UserId:a,MemberId:r}=e;t.push({UserId:a,MemberId:r})})}}).then(()=>{const e=[];t.forEach(t=>{const{UserId:r,MemberId:n}=t;ajaxHandler("get",`/api/v1/users/${r}`,{},"session").then(a=>{const t=JSON.parse(a);if(t.type)alertHandler($alert,"danger",t.message);else{const{UserId:a,Active:r,LastName:i,FirstName:s,Email:l}=t[0];e.push(`<li data-icon="delete">\n                <a href="#" class="remove-member-link" data-id="${n}">${s} ${i}</a>\n              </li>\n              `),$(".member-list-added").html(e).listview("refresh").trigger("create")}}).then(()=>{$(".remove-member-link").click(function(e){e.preventDefault(),ajaxHandler("delete",`/api/v1/members/${$(this).attr("data-id")}`,{},"session").then(e=>{$(".member-list-added").listview("refresh").trigger("create"),a()}).fail(e=>{alertHandler($alert,"danger","Server Error")})})}).fail(e=>{alertHandler($alert,"danger","Server Error")})})}).fail(e=>{alertHandler($alert,"danger","Server Error")})}a();function t(){ajaxHandler("get","/api/v1/users",{},"session").then(e=>{const a=JSON.parse(e);if(a.type)alertHandler($alert,"danger",a.message);else{const e=[];a.forEach(a=>{const{UserId:t,Active:r,LastName:n,FirstName:i,Email:s}=a;e.push(`\n              <li data-icon="plus"><a href="#" class="add-member-link" data-id="${t}">${i} ${n}</a></li>\n            `)}),$(".member-list-toadd").html(e).listview("refresh").trigger("create")}}).then(()=>{$(".add-member-link").click(function(e){e.preventDefault();const t=window.currentId;ajaxHandler("post","/api/v1/members",{UserId:$(this).attr("data-id"),TeamId:t},"session").then(()=>{$(".member-list-added").listview("refresh").trigger("create"),a()}).fail(e=>{alertHandler($alert,"danger","Server Error")})})}).fail(e=>{alertHandler($alert,"danger","Server Error")})}t()}}),$(document).on("pagecontainershow",()=>{if("training-detail"===$("body").pagecontainer("getActivePage").prop("id")){const t=window.currentId;function e(){const e=[];ajaxHandler("get",`/api/v1/trainings/${t}`,{},"session").then(a=>{const t=JSON.parse(a);if(t.type)alertHandler($alert,"danger",t.message);else{const{Participants:a}=t[0];a.forEach(a=>{const{UserId:t,ParticipantId:r}=a;e.push({UserId:t,ParticipantId:r})})}}).then(()=>{const a=[];e.forEach(e=>{const{UserId:t,TrainingId:r}=e;ajaxHandler("get",`/api/v1/users/${t}`,{},"session").then(e=>{const t=JSON.parse(e);if(t.type)alertHandler($alert,"danger",t.message);else{const t=JSON.parse(e),{UserId:r,Active:n,LastName:i,FirstName:s,Email:l}=t[0];a.push(`\n                <li data-icon="false"><a href="#" class="remove-participant-link">${s} ${i}</a></li>\n              `),$(".participant-list").html(a).listview("refresh").trigger("create")}}).fail(e=>{alertHandler($alert,"danger","Server Error")})})}).fail(e=>{alertHandler($alert,"danger","Server Error")})}e();function a(e){ajaxHandler("get",`/api/v1/trainings/${window.currentId}`,{},"session").then(a=>{const t=JSON.parse(a);if(t.type)alertHandler($alert,"danger",t.message);else{const{Participants:a}=t[0];let r=a.find(e=>e.UserId===$.session.get("loggedInUserId"));e(!!r&&r.ParticipantId)}}).fail(e=>{alertHandler($alert,"danger","Server Error")})}a(e=>{e?($(".add-participant-link").hide(),$(".remove-participant-link").show()):($(".add-participant-link").show(),$(".remove-participant-link").hide())}),$(".add-participant-link").click(a=>{a.preventDefault();const t=window.currentId;ajaxHandler("post","/api/v1/participants",{UserId:$.session.get("loggedInUserId"),TrainingId:t},"session").then(a=>{e(),$(".add-participant-link").hide(),$(".remove-participant-link").show()}).fail(e=>{alertHandler($alert,"danger","Server Error")})}),$(".remove-participant-link").click(t=>{t.preventDefault();const r=window.currentId,n={UserId:$.session.get("loggedInUserId"),TrainingId:r};a(a=>{a&&ajaxHandler("delete",`/api/v1/participants/${a}`,n,"session").then(a=>{e(),$(".add-participant-link").show(),$(".remove-participant-link").hide()}).fail(e=>{alertHandler($alert,"danger","Server Error")})})})}}),$(function(){$("#signup-form").submit(e=>{e.preventDefault();const a=$(this).find(".alert"),t=$("#active-signup"),r=$("#firstname-signup"),n=$("#lastname-signup"),i=$("#email-signup"),s=$("#password-signup");ajaxHandler("post","/api/v1/register",{Active:t.val(),FirstName:r.val(),LastName:n.val(),Email:i.val(),Password:s.val()},"no").then(e=>{const l=JSON.parse(e);"Warning"==l.type||"Error"==l.type?alertHandler(a,"danger",l.message):(alertHandler(a,"success","User created"),t.val(""),r.val(""),n.val(""),i.val(""),s.val(""))}).fail(e=>{alertHandler(a,"danger","Server Error")})}),$("#signin-form").submit(e=>{e.preventDefault();const a=$(this).find(".alert"),t=$("#email-signin"),r=$("#password-signin");ajaxHandler("get","/api/v1/users",{email:t.val(),password:r.val()},"yes").then(e=>{const n=JSON.parse(e);if("Warning"==n.type||"Error"==n.type)alertHandler(a,"danger",n.message);else{const e=n.find(e=>e.Email===t.val()).UserId;$.session.set("loggedInUserId",e),$.session.set("Authorization",basicAuth(t.val(),r.val())),$.mobile.pageContainer.pagecontainer("change","#user"),t.val(""),r.val("")}}).fail(e=>{alertHandler(a,"danger","Server Error")})})}),$(document).on("pagecontainershow",()=>{const e=$("body").pagecontainer("getActivePage").prop("id");if("team"===e){const e=$(".table-team-list").find(".alert");ajaxHandler("get","/api/v1/teams",{},"session").then(a=>{const t=JSON.parse(a);if(t.type)alertHandler(e,"danger",t.message);else{const e=[];t.forEach(a=>{const{TeamId:t,OwnerId:r,Name:n,Website:i}=a;e.push(`\n            <tr>\n              <td>${t}</td>\n              <td>${n}</td>\n              <td>${i||""}</td>\n              <td><a href="#team-detail" data-id="${t}" class="team-link-detail ui-btn ui-icon-plus ui-btn-icon-notext ui-corner-all">Detail</a></td>\n            </tr>\n          `)}),$(".tbody-team").html(e)}}).then(()=>{$(".team-link-detail").click(function(e){const a=$(this).attr("data-id");window.currentId=a})}).fail(a=>{alertHandler(e,"danger","Server Error")})}if("team-detail"===e){const e=window.currentId;if(e){const a=$(".wrapper-listview-team-detail").find(".alert");ajaxHandler("get",`/api/v1/teams/${e}`,{},"session").then(e=>{const t=JSON.parse(e);if(t.type)alertHandler(a,"danger",t.message);else{const e=[];t.forEach(a=>{const{TeamId:t,OwnerId:r,Name:n,Website:i}=a;e.push(`\n              <li><label>TeamId</label> ${t}</li>\n              <li><label>Name</label> ${n}</li>\n              <li><label>Website</label> ${i||""}</li>\n            `)}),$(".listview-team-detail").html(e).listview("refresh").trigger("create")}}).fail(e=>{alertHandler(a,"danger","Server Error")})}}"team-edit"===e&&ajaxHandler("get",`/api/v1/teams/${window.currentId}`,{},"session").then(e=>{const a=JSON.parse(e),{Name:t,Website:r}=a[0];$("#name-team-edit").val(t),$("#website-team-edit").val(r)}).fail(e=>{alertHandler($alert,"danger","Server Error")})}),$(function(){$("#team-add-form").submit(e=>{e.preventDefault();const a=$(this).find(".alert"),t=$.session.get("loggedInUserId"),r=$("#name-team-add"),n=$("#website-team-add");ajaxHandler("post","/api/v1/teams",{OwnerId:t,Name:r.val(),Website:n.val()},"session").then(e=>{const t=JSON.parse(e);"Warning"==t.type||"Error"==t.type?alertHandler(a,"danger",t.message):(alertHandler(a,"success","Team created"),r.val(""),n.val(""))}).fail(e=>{alertHandler(a,"danger","Server Error")})}),$("#team-edit-form").submit(e=>{e.preventDefault();const a=window.currentId,t=$(this).find(".alert"),r=$("#name-team-edit"),n=$("#website-team-edit");ajaxHandler("put",`/api/v1/teams/${a}`,{Name:r.val(),Website:n.val()},"session").then(e=>{const a=JSON.parse(e);"Warning"==a.type||"Error"==a.type?alertHandler(t,"danger",a.message):alertHandler(t,"success","Team edited")}).fail(e=>{alertHandler(t,"danger","Server Error")})}),$("#team-link-delete").click(e=>{e.preventDefault(),ajaxHandler("delete",`/api/v1/teams/${window.currentId}`,{},"session").then(e=>{$.mobile.pageContainer.pagecontainer("change","#team")}).fail(e=>{alertHandler($alert,"danger","Server Error")})})}),$(document).on("pagecontainershow",()=>{const e=$("body").pagecontainer("getActivePage").prop("id");if("training"===e&&($alert=$(".table-training-list").find(".alert"),ajaxHandler("get","/api/v1/trainings",{},"session").then(e=>{const a=JSON.parse(e);if(a.type)alertHandler($alert,"danger",a.message);else{const a=[];JSON.parse(e).forEach(e=>{const{TrainingId:t,TeamId:r,Title:n,Date:i,Time:s}=e;ajaxHandler("get",`/api/v1/teams/${r}`,{},"session").then(e=>{const r=JSON.parse(e);if(r.type)alertHandler($alert,"danger",r.message);else{const{Name:e}=r[0];a.push(`\n                <tr>\n                  <td>${t}</td>\n                  <td>${n}</td>\n                  <td>${i}</td>\n                  <td>${s}</td>\n                  <td>${e}</td>\n                  <td><a href="#training-detail" data-id="${t}" class="training-link-detail ui-btn ui-icon-plus ui-btn-icon-notext ui-corner-all">Detail</a></td>\n                </tr>\n              `),$(".tbody-training").html(a)}}).then(()=>{$(".training-link-detail").click(function(e){const a=$(this).attr("data-id");window.currentId=a})}).fail(e=>{alertHandler($alert,"danger","Server Error")})})}}).fail(e=>{alertHandler($alert,"danger","Server Error")})),"training-detail"===e){$alert=$(".alert-training");const e=window.currentId;e&&ajaxHandler("get",`/api/v1/trainings/${e}`,{},"session").then(e=>{const a=JSON.parse(e);if(a.type)alertHandler($alert,"danger",a.message);else{const e=[];a.forEach(a=>{const{TrainingId:t,TeamId:r,Title:n,Date:i,Time:s,Duration:l,MinParticipants:d,Description:o}=a;ajaxHandler("get",`/api/v1/teams/${r}`,{},"session").then(a=>{const r=JSON.parse(a);if(r.type)alertHandler($alert,"danger",r.message);else{const{Name:a}=r[0];e.push(`\n                  <li><label>TrainingId</label> ${t}</li>\n                  <li><label>Title</label> ${n}</li>\n                  <li><label>Team</label> ${a}</li>\n                  <li><label>Date</label> ${i}</li>\n                  <li><label>Time</label> ${s}</li>\n                  <li><label>Duration</label> ${l||""}</li>\n                  <li><label>MinParticipants</label> ${d||""}</li>\n                  <li><label>Description</label> ${o||""}</li>\n                `),$(".listview-training-detail").html(e).listview("refresh").trigger("create")}}).fail(e=>{alertHandler($alert,"danger","Server Error")})})}}).fail(e=>{alertHandler($alert,"danger","Server Error")})}"training-add"!==e&&"training-edit"!==e||ajaxHandler("get","/api/v1/teams",{},"session").then(e=>{const a=[];JSON.parse(e).forEach(e=>{const{TeamId:t,Name:r}=e;a.push(`\n          <option value="${t}">${r}</option>\n        `)}),$("#team-training-add").html(a),$("#team-training-edit").html(a)}).fail(e=>{alertHandler($alert,"danger","Server Error")}),"training-edit"===e&&ajaxHandler("get",`/api/v1/trainings/${window.currentId}`,{},"session").then(e=>{const a=JSON.parse(e),{TeamId:t,Title:r,Date:n,Time:i,Duration:s,MinParticipants:l,Description:d}=a[0];$("#team-training-edit").val(t).change(),$("#title-training-edit").val(r),$("#date-training-edit").val(n),$("#time-training-edit").val(i),$("#duration-training-edit").val(s),$("#participants-training-edit").val(l),$("#description-training-edit").val(d)}).fail(e=>{alertHandler($alert,"danger","Server Error")})}),$(function(){$("#training-add-form").submit(e=>{e.preventDefault();window.currentId;const a=$(this).find(".alert"),t=$("#team-training-add"),r=$("#title-training-add"),n=$("#date-training-add"),i=$("#time-training-add"),s=$("#duration-training-add"),l=$("#participants-training-add"),d=$("#description-training-add");ajaxHandler("post","/api/v1/training",{TeamId:t.val(),Title:r.val(),Date:n.val(),Time:i.val(),Duration:s.val(),MinParticipants:l.val(),Description:d.val()},"session").then(e=>{const o=JSON.parse(e);"Warning"==o.type||"Error"==o.type?alertHandler(a,"danger",o.message):(alertHandler(a,"success","Training created"),t.val(""),r.val(""),n.val(""),i.val(""),s.val(""),l.val(""),d.val(""))}).fail(e=>{alertHandler(a,"danger","Server Error")})}),$("#training-edit-form").submit(e=>{e.preventDefault();const a=window.currentId,t=$(this).find(".alert"),r=$("#team-training-edit"),n=$("#title-training-edit"),i=$("#date-training-edit"),s=$("#time-training-edit"),l=$("#duration-training-edit"),d=$("#participants-training-edit"),o=$("#description-training-edit");ajaxHandler("put",`/api/v1/trainings/${a}`,{TeamId:r.val(),Title:n.val(),Date:i.val(),Time:s.val(),Duration:l.val(),MinParticipants:d.val(),Description:o.val()},"session").then(e=>{const a=JSON.parse(e);"Warning"==a.type||"Error"==a.type?alertHandler(t,"danger",a.message):alertHandler(t,"success","Training edited")}).fail(e=>{alertHandler(t,"danger","Server Error")})}),$("#training-link-delete").click(e=>{e.preventDefault(),ajaxHandler("delete",`/api/v1/trainings/${window.currentId}`,{},"session").then(e=>{$.mobile.pageContainer.pagecontainer("change","#training")}).fail(e=>{alertHandler($alert,"danger","Server Error")})})}),$(document).on("pagecontainershow",()=>{const e=$("body").pagecontainer("getActivePage").prop("id");if("user"===e){const e=$(".table-user-list").find(".alert");ajaxHandler("get","/api/v1/users",{},"session").then(a=>{const t=JSON.parse(a);if(t.type)alertHandler(e,"danger",t.message);else{const e=[];t.forEach(a=>{const{UserId:t,Active:r,LastName:n,FirstName:i,Email:s}=a;e.push(`\n            <tr>\n              <td>${i}</td>\n              <td>${n}</td>\n              <td>${s}</td>\n              <td>${r}</td>\n              <td><a href="#user-detail" data-id="${t}" class="user-link-detail ui-btn ui-icon-plus ui-btn-icon-notext ui-corner-all">Detail</a></td>\n            </tr>\n          `)}),$(".tbody-user").html(e)}}).then(()=>{$(".user-link-detail").click(function(e){const a=$(this).attr("data-id");window.currentId=a})}).fail(a=>{alertHandler(e,"danger","Server Error")})}if("user-detail"===e){const e=window.currentId;if(e){const a=$(".table-user-detail").find(".alert");ajaxHandler("get",`/api/v1/users/${e}`,{},"session").then(e=>{const t=JSON.parse(e);if(t.type)alertHandler(a,"danger",t.message);else{const e=[];t.forEach(a=>{const{UserId:t,Active:r,LastName:n,FirstName:i,Email:s}=a;e.push(`\n              <tr>\n                <td>${i}</td>\n                <td>${n}</td>\n                <td>${s}</td>\n                <td>${r}</td>\n              </tr>\n            `)}),$(".tbody-user-detail").html(e)}}).fail(e=>{alertHandler(a,"danger","Server Error")})}}"user-edit"===e&&ajaxHandler("get",`/api/v1/users/${$.session.get("loggedInUserId")}`,{},"session").then(e=>{const a=JSON.parse(e),{UserId:t,Active:r,LastName:n,FirstName:i,Email:s}=a[0];$("#active-user-edit").val(r).change(),$("#firstname-user-edit").val(i),$("#lastname-user-edit").val(n),$("#email-user-edit").val(s)}).fail(e=>{alertHandler($alert,"danger","Server Error")})}),$(function(){$("#user-edit-form").submit(e=>{e.preventDefault();const a=$(this).find(".alert"),t=$("#active-user-edit"),r=$("#firstname-user-edit"),n=$("#lastname-user-edit"),i=$("#email-user-edit"),s={Active:t.val(),FirstName:r.val(),LastName:n.val(),Email:i.val()};ajaxHandler("put",`/api/v1/users/${$.session.get("loggedInUserId")}`,s,"session").then(e=>{const t=JSON.parse(e);"Warning"==t.type||"Error"==t.type?alertHandler(a,"danger",t.message):alertHandler(a,"success","User updated")}).fail(e=>{alertHandler(a,"danger","Server Error")})})}),function(e){e.session={_id:null,_cookieCache:void 0,_init:function(){window.name||(window.name=Math.random()),this._id=window.name,this._initCache();var e=new RegExp(this._generatePrefix()+"=([^;]+);").exec(document.cookie);if(e&&document.location.protocol!==e[1]){this._clearSession();for(var a in this._cookieCache)try{window.sessionStorage.setItem(a,this._cookieCache[a])}catch(e){}}document.cookie=this._generatePrefix()+"="+document.location.protocol+";path=/;expires="+new Date((new Date).getTime()+12e4).toUTCString()},_generatePrefix:function(){return"__session:"+this._id+":"},_initCache:function(){var e=document.cookie.split(";");this._cookieCache={};for(var a in e){var t=e[a].split("=");new RegExp(this._generatePrefix()+".+").test(t[0])&&t[1]&&(this._cookieCache[t[0].split(":",3)[2]]=t[1])}},_setFallback:function(e,a,t){var r=this._generatePrefix()+e+"="+a+"; path=/";return t&&(r+="; expires="+new Date(Date.now()+12e4).toUTCString()),document.cookie=r,this._cookieCache[e]=a,this},_getFallback:function(e){return this._cookieCache||this._initCache(),this._cookieCache[e]},_clearFallback:function(){for(var e in this._cookieCache)document.cookie=this._generatePrefix()+e+"=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;";this._cookieCache={}},_deleteFallback:function(e){document.cookie=this._generatePrefix()+e+"=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;",delete this._cookieCache[e]},get:function(e){return window.sessionStorage.getItem(e)||this._getFallback(e)},set:function(e,a,t){try{window.sessionStorage.setItem(e,a)}catch(e){}return this._setFallback(e,a,t||!1),this},delete:function(e){return this.remove(e)},remove:function(e){try{window.sessionStorage.removeItem(e)}catch(e){}return this._deleteFallback(e),this},_clearSession:function(){try{window.sessionStorage.clear()}catch(a){for(var e in window.sessionStorage)window.sessionStorage.removeItem(e)}},clear:function(){return this._clearSession(),this._clearFallback(),this}},e.session._init()}(jQuery);